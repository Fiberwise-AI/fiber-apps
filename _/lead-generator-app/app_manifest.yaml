app:
  app_slug: lead-generator-app
  category: business
  description: "Automated B2B lead generation pipeline that finds, enriches, and qualifies local business leads with human approval."
  entryPoint: index.js
  icon: fas fa-bullseye
  models:
  - description: Lead records generated by the pipeline
    fields:
    - description: Primary key for the lead record
      field_column: lead_id
      is_primary_key: true
      name: Lead ID
      required: true
      type: uuid
    - field_column: company_name
      name: Company Name
      required: true
      type: string
    - field_column: website
      name: Website
      type: string
    - field_column: phone_number
      name: Phone Number
      type: string
    - field_column: address
      name: Address
      type: string
    - field_column: linkedin_url
      name: LinkedIn URL
      type: string
    - field_column: twitter_url
      name: Twitter URL
      type: string
    - field_column: facebook_url
      name: Facebook URL
      type: string
    - field_column: instagram_url
      name: Instagram URL
      type: string
    - field_column: lead_score
      name: Lead Score
      type: integer
      default: 0
    - field_column: ai_reasoning
      name: AI Reasoning
      type: text
    - field_column: human_decision
      name: Human Decision
      type: string
    - field_column: human_notes
      name: Human Notes
      type: text
    - field_column: status
      name: Status
      type: string
      default: "new"
    - field_column: source_query
      name: Source Query
      type: string
    - field_column: place_id
      name: Google Place ID
      type: string
    - description: ID of the user who owns this lead
      field_column: user_id
      is_system_field: true
      name: User ID
      type: string
    - default: CURRENT_TIMESTAMP
      field_column: created_at
      is_system_field: true
      name: Created At
      type: timestamp
    - default: CURRENT_TIMESTAMP
      field_column: updated_at
      is_system_field: true
      name: Updated At
      type: timestamp
    model_slug: leads
    name: Lead
  - description: Pipeline execution sessions for tracking runs
    fields:
    - description: Primary key for the execution session
      field_column: session_id
      is_primary_key: true
      name: Session ID
      required: true
      type: uuid
    - field_column: business_type
      name: Business Type
      required: true
      type: string
    - field_column: location
      name: Location
      required: true
      type: string
    - field_column: status
      name: Status
      type: string
      default: "running"
    - field_column: current_step
      name: Current Step
      type: string
    - field_column: step_results
      name: Step Results
      type: json
    - field_column: final_result
      name: Final Result
      type: json
    - field_column: error_message
      name: Error Message
      type: text
    - description: ID of the user who started this session
      field_column: user_id
      is_system_field: true
      name: User ID
      type: string
    - default: CURRENT_TIMESTAMP
      field_column: created_at
      is_system_field: true
      name: Created At
      type: timestamp
    - default: CURRENT_TIMESTAMP
      field_column: updated_at
      is_system_field: true
      name: Updated At
      type: timestamp
    model_slug: pipeline-sessions
    name: Pipeline Session
  name: Lead Generator App
  publisher: FiberWise
  routes:
  - component: lead-generator-app
    icon: fas fa-bullseye
    path: /
    title: Lead Generator
  version: "1.0.0"

pipelines:
  - name: "B2B Lead Generation Pipeline"
    description: "Finds, enriches, and qualifies local business leads, with human approval."
    structure:
      version: "1.2"
      description: "Finds, enriches, and qualifies local business leads, with human approval."
      steps:
        - id: "find_businesses"
          name: "Find Businesses by Location"
          type: "task"
          implementation_path: "pipelines/steps/google/places_search.py"
          class: "PlacesSearchStep"
          parameters:
            query: "{pipeline_input.business_type} in {pipeline_input.location}"
          input_schema:
            type: "object"
            properties:
              query:
                type: "string"
                description: "The search query for the Places API."
            required: ["query"]
          output_schema:
            type: "object"
            properties:
              places:
                type: "array"
                items:
                  type: "object"
                  properties:
                    id:
                      type: "string"
                    name:
                      type: "string"
                  required: ["id"]
        
        - id: "get_top_business_details"
          name: "Get Details for Top Result"
          type: "task"
          implementation_path: "pipelines/steps/google/place_details.py"
          class: "PlaceDetailsStep"
          parameters:
            place_id: "{steps.find_businesses.result.places[0].id}"
          input_schema:
            type: "object"
            properties:
              place_id:
                type: "string"
                description: "The unique ID of the business from the Places API."
            required: ["place_id"]
          output_schema:
            type: "object"
            properties:
              name:
                type: "string"
              website:
                type: "string"
              phone_number:
                type: "string"
              address:
                type: "string"
        
        - id: "enrich_with_socials"
          name: "Enrich with Social Media Links"
          type: "task"
          implementation_path: "pipelines/steps/agents/enricher.py"
          class: "AgentEnricherStep"
          parameters:
            agent_id: "social_media_finder_agent"
            prompt: "Find the official LinkedIn and Twitter URLs for the company '{steps.get_top_business_details.result.name}' whose website is {steps.get_top_business_details.result.website}. Respond with a single JSON object: {\"linkedin_url\": \"...\", \"twitter_url\": \"...\"} or null if not found."
          input_schema:
            type: "object"
            properties:
              agent_id:
                type: "string"
              prompt:
                type: "string"
            required: ["agent_id", "prompt"]
          output_schema:
            type: "object"
            properties:
              linkedin_url:
                type: ["string", "null"]
              twitter_url:
                type: ["string", "null"]
        
        - id: "score_lead_quality"
          name: "Score Lead Quality"
          type: "task"
          implementation_path: "pipelines/steps/agents/scorer.py"
          class: "AgentScorerStep"
          parameters:
            agent_id: "b2b_lead_scorer_agent"
            prompt: "Analyze the following business profile and score its quality as a lead for our marketing services on a scale of 1-100. Consider the business type, website, and social presence. Business Info: {steps.get_top_business_details.result}. Social Media: {steps.enrich_with_socials.result}. Respond with a single JSON object: {\"score\": <number>, \"reasoning\": \"...\"}."
          input_schema:
            type: "object"
            properties:
              agent_id:
                type: "string"
              prompt:
                type: "string"
            required: ["agent_id", "prompt"]
          output_schema:
            type: "object"
            properties:
              score:
                type: "integer"
              reasoning:
                type: "string"
        
        - id: "human_review_lead"
          name: "Human Review and Approval"
          type: "human_input"
          parameters:
            ui_schema:
              type: "object"
              title: "Lead Review and Approval"
              properties:
                lead_summary:
                  type: "object"
                  title: "Lead Summary"
                  properties:
                    company_name:
                      type: "string"
                      title: "Company Name"
                      default: "{steps.get_top_business_details.result.name}"
                      ui:readonly: true
                    website:
                      type: "string"
                      title: "Website"
                      default: "{steps.get_top_business_details.result.website}"
                      ui:readonly: true
                    linkedin:
                      type: "string"
                      title: "LinkedIn"
                      default: "{steps.enrich_with_socials.result.linkedin_url}"
                      ui:readonly: true
                    ai_score:
                      type: "integer"
                      title: "AI Quality Score"
                      default: "{steps.score_lead_quality.result.score}"
                      ui:readonly: true
                    ai_reasoning:
                      type: "string"
                      title: "AI Reasoning"
                      default: "{steps.score_lead_quality.result.reasoning}"
                      ui:readonly: true
                      ui:widget: "textarea"
                decision:
                  type: "string"
                  title: "Decision"
                  enum: ["Approve", "Reject"]
                  enumNames: ["✅ Approve - Add to CRM", "❌ Reject - Skip this lead"]
                notes:
                  type: "string"
                  title: "Notes"
                  description: "Add any additional notes about this lead"
                  ui:widget: "textarea"
              required: ["decision"]
          input_schema:
            type: "object"
            properties:
              ui_schema:
                type: "object"
                description: "Defines the form presented to the user."
          output_schema:
            type: "object"
            description: "The data submitted by the human user."
            properties:
              decision:
                type: "string"
                enum: ["Approve", "Reject"]
              notes:
                type: "string"
            required: ["decision"]
        
        - id: "save_lead_to_database"
          name: "Save Lead to Database"
          type: "task"
          implementation_path: "pipelines/steps/database/save_lead.py"
          class: "SaveLeadStep"
          parameters:
            session_id: "{pipeline_execution.session_id}"
            company_name: "{steps.get_top_business_details.result.name}"
            website: "{steps.get_top_business_details.result.website}"
            phone_number: "{steps.get_top_business_details.result.phone_number}"
            address: "{steps.get_top_business_details.result.address}"
            place_id: "{steps.find_businesses.result.places[0].id}"
            linkedin_url: "{steps.enrich_with_socials.result.linkedin_url}"
            twitter_url: "{steps.enrich_with_socials.result.twitter_url}"
            facebook_url: "{steps.enrich_with_socials.result.facebook_url}"
            instagram_url: "{steps.enrich_with_socials.result.instagram_url}"
            lead_score: "{steps.score_lead_quality.result.score}"
            ai_reasoning: "{steps.score_lead_quality.result.reasoning}"
            human_decision: "{steps.human_review_lead.result.decision}"
            human_notes: "{steps.human_review_lead.result.notes}"
            source_query: "{pipeline_input.business_type} in {pipeline_input.location}"
          input_schema:
            type: "object"
            properties:
              session_id:
                type: "string"
              company_name:
                type: "string"
              website:
                type: "string"
              phone_number:
                type: ["string", "null"]
              address:
                type: ["string", "null"]
              place_id:
                type: "string"
              linkedin_url:
                type: ["string", "null"]
              twitter_url:
                type: ["string", "null"]
              facebook_url:
                type: ["string", "null"]
              instagram_url:
                type: ["string", "null"]
              lead_score:
                type: "integer"
              ai_reasoning:
                type: "string"
              human_decision:
                type: "string"
              human_notes:
                type: ["string", "null"]
              source_query:
                type: "string"
            required: ["session_id", "company_name", "website", "human_decision"]
          output_schema:
            type: "object"
            properties:
              success:
                type: "boolean"
              lead_id:
                type: "string"
      
      flow:
        start: "find_businesses"
        transitions:
          - from: "find_businesses"
            to: "get_top_business_details"
            condition:
              type: "expression"
              expression: "len(steps.find_businesses.result.places) > 0"
          
          - from: "find_businesses"
            to: "end_with_failure"
            condition:
              type: "expression"
              expression: "len(steps.find_businesses.result.places) == 0"
          
          - from: "get_top_business_details"
            to: "enrich_with_socials"
          
          - from: "enrich_with_socials"
            to: "score_lead_quality"
          
          - from: "score_lead_quality"
            to: "human_review_lead"
          
          - from: "human_review_lead"
            to: "save_lead_to_database"
            condition:
              type: "expression"
              expression: "steps.human_review_lead.result.decision == 'Approve'"
          
          - from: "human_review_lead"
            to: "save_lead_to_database"
            condition:
              type: "expression"
              expression: "steps.human_review_lead.result.decision == 'Reject'"
          
          - from: "save_lead_to_database"
            to: "end_with_success"
        
        outcomes:
          end_with_success:
            status: "completed"
            message: "Lead processing completed successfully"
          end_with_failure:
            status: "failed"
            message: "No businesses found for the specified criteria"

functions: []
workflows: []