<style>
    :host {
      display: block;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --primary-color: #4f46e5;
      --primary-hover: #4338ca;
      --secondary-color: #6b7280;
      --background-color: #f9fafb;
      --surface-color: #ffffff;
      --border-color: #e5e7eb;
      --text-primary: #111827;
      --text-secondary: #4b5563;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --info-color: #3b82f6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    
    .header h1 {
      margin: 0;
      font-size: 1.75rem;
      color: var(--text-primary);
    }
    
    .templates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    
    .template-card {
      background-color: var(--surface-color);
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }
    
    .template-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.12);
    }
    
    .template-card.selected {
      border: 2px solid var(--primary-color);
    }
    
    .template-name {
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0 0 0.5rem 0;
      color: var(--text-primary);
    }
    
    .template-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin: 0 0 1rem 0;
      flex-grow: 1;
    }
    
    .template-preview {
      font-size: 0.75rem;
      color: var(--secondary-color);
      background-color: var(--background-color);
      padding: 0.75rem;
      border-radius: 0.375rem;
      white-space: pre-wrap;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      max-height: 4.5rem;
    }
    
    .template-actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 1rem;
      gap: 0.5rem;
    }
    
    .action-button {
      padding: 0.5rem;
      background: none;
      border: none;
      color: var(--secondary-color);
      cursor: pointer;
      border-radius: 0.25rem;
    }
    
    .action-button:hover {
      background-color: var(--background-color);
      color: var(--text-primary);
    }
    
    .add-button {
      padding: 0.5rem 1rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    
    .add-button:hover {
      background-color: var(--primary-hover);
    }
    
    .template-form {
      background-color: var(--surface-color);
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
    }
    
    .form-title {
      margin: 0 0 1.5rem 0;
      font-size: 1.25rem;
      color: var(--text-primary);
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
    }
    
    .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 0.375rem;
      font-size: 0.875rem;
      color: var(--text-primary);
    }
    
    textarea.form-control {
      min-height: 200px;
      font-family: monospace;
      white-space: pre;
      resize: vertical;
    }
    
    .form-hint {
      margin-top: 0.375rem;
      font-size: 0.75rem;
      color: var (--secondary-color);
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }
    
    .cancel-button {
      padding: 0.5rem 1rem;
      background-color: var(--background-color);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
    }
    
    .save-button {
      padding: 0.5rem 1rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.375rem;
      font-weight: 500;
      cursor: pointer;
    }
    
    .save-button:hover {
      background-color: var (--primary-hover);
    }
    
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      color: var(--secondary-color);
    }
    
    .spinner {
      width: 2rem;
      height: 2rem;
      border: 3px solid rgba(79, 70, 229, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s linear infinite;
      margin-right: 0.75rem;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .error-container {
      padding: 1rem;
      background-color: #fee2e2;
      border-radius: 0.375rem;
      color: #b91c1c;
      margin-bottom: 1rem;
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--secondary-color);
    }
    
    .empty-illustration {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--border-color);
    }
    
    .notification-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      z-index: 1000;
    }
    
    .notification {
      background-color: var(--surface-color);
      border-radius: 0.375rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 0.75rem 1rem;
      min-width: 250px;
      max-width: 350px;
      border-left: 4px solid var(--info-color);
      animation: slide-in 0.3s ease forwards;
      transition: opacity 0.3s, transform 0.3s;
    }
    
    .notification.success {
      border-left-color: var(--success-color);
    }
    
    .notification.error {
      border-left-color: var(--error-color);
    }
    
    .notification.warning {
      border-left-color: var(--warning-color);
    }
    
    .notification.fade-out {
      opacity: 0;
      transform: translateX(100%);
    }
    
    @keyframes slide-in {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .template-examples {
      background-color: var(--surface-color);
      border-radius: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-top: 2rem;
    }
    
    .examples-title {
      margin: 0 0 1rem 0;
      font-size: 1.25rem;
      color: var(--text-primary);
    }
    
    .example-item {
      margin-bottom: 1.5rem;
    }
    
    .example-name {
      font-weight: 600;
      margin: 0 0 0.5rem 0;
    }
    
    .example-preview {
      font-size: 0.75rem;
      color: var(--secondary-color);
      background-color: var(--background-color);
      padding: 0.75rem;
      border-radius: 0.375rem;
      white-space: pre-wrap;
      margin-bottom: 0.5rem;
    }
    
    .use-example-button {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background-color: var (--background-color);
      border: 1px solid var(--border-color);
      color: var (--text-primary);
      border-radius: 0.25rem;
      font-size: 0.75rem;
      cursor: pointer;
    }
    
    .use-example-button:hover {
      background-color: var(--border-color);
    }
  </style>
  
  <div class="container">
    <div class="notification-container"></div>
    
    <div class="header">
      <h1>Prompt Templates</h1>
      {{^editingTemplate}}
        <button class="add-button" id="add-template-button">
          <i class="fas fa-plus"></i> New Template
        </button>
      {{/editingTemplate}}
    </div>
    
    {{#error}}
      <div class="error-container">
        {{error}}
      </div>
    {{/error}}
    
    {{#loading}}
      <div class="loading-container">
        <div class="spinner"></div>
        <div>Loading templates...</div>
      </div>
    {{/loading}}
    
    {{#editingTemplate}}
      <div class="template-form">
        <h2 class="form-title">{{#template_id}}Edit Template{{/template_id}}{{^template_id}}Create New Template{{/template_id}}</h2>
        
        <form id="template-form">
          <div class="form-group">
            <label class="form-label" for="template_name">Template Name</label>
            <input 
              type="text" 
              class="form-control" 
              id="template_name" 
              name="template_name" 
              placeholder="e.g., Email Analysis, Reply Suggestion"
              value="{{template_name}}"
              required
            >
            <div class="form-hint">A short, descriptive name for this template</div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="description">Description</label>
            <input 
              type="text" 
              class="form-control" 
              id="description" 
              name="description" 
              placeholder="e.g., Template for analyzing email sentiment and priority"
              value="{{description}}"
            >
            <div class="form-hint">Optional description of what this template does</div>
          </div>
          
          <div class="form-group">
            <label class="form-label" for="template_content">Template Content</label>
            <textarea 
              class="form-control" 
              id="template_content" 
              name="template_content" 
              placeholder="Enter your prompt template with placeholders like {sender}, {subject}, {body}..."
              required
            >{{template_content}}</textarea>
            <div class="form-hint">
              Use placeholders like {sender}, {subject}, {body}, {date} that will be replaced with actual values.
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="cancel-button" id="cancel-button">Cancel</button>
            <button type="submit" class="save-button">Save Template</button>
          </div>
        </form>
      </div>
      
      <!-- Examples section for template editing -->
      <div class="template-examples">
        <h2 class="examples-title">Example Templates</h2>
        <!-- Example templates section... -->
      </div>
    {{/editingTemplate}}
    
    {{^editingTemplate}}
      {{#templates.length}}
        <div class="templates-grid">
          {{#templates}}
            <email-template-card
              template-id="{{template_id}}"
              template-name="{{template_name}}"
              description="{{description}}"
              preview="{{template_content}}"
              {{#selected}}selected{{/selected}}
            ></email-template-card>
          {{/templates}}
        </div>
      {{/templates.length}}
      
      {{^templates.length}}
        <div class="empty-state">
          <div class="empty-illustration">
            <i class="fas fa-file-alt"></i>
          </div>
          <h2>No Templates Yet</h2>
          <p>Create your first template to customize how AI analyzes your emails</p>
        </div>
      {{/templates.length}}
    {{/editingTemplate}}
  </div>